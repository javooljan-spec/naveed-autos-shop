<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NAVEED AUTOSE SHOP MANAGEMENT</title>
    <style>
        body {
            font-family: Arial;
            background-color: var(--bg);
            color: var(--text);
            margin: 40px;
            transition: 0.3s;
        }
        :root {
            --bg: #f4f4f4;
            --text: #000;
            --card: #fff;
        }
        .dark-mode {
            --bg: #121212;
            --text: #fff;
            --card: #1e1e1e;
        }
        .section {
            background: var(--card);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            box-shadow: 0px 0px 5px #333;
        }
        input, button, select {
            margin: 5px;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #999;
        }
        button {
            background: darkblue;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background: #003399;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #999;
            padding: 8px;
            text-align: center;
        }

        /* Summary Dashboard */
        .dashboard {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }
        .card {
            background: var(--card);
            border-radius: 10px;
            box-shadow: 0 0 8px #333;
            padding: 20px;
            text-align: center;
            width: 200px;
            margin: 10px;
        }
        .card h3 {
            margin: 10px 0 5px 0;
        }
        .card p {
            font-size: 20px;
            font-weight: bold;
        }

        @media (max-width: 600px) {
            body { margin: 10px; }
            .section { padding: 10px; }
            table, th, td { font-size: 12px; }
            .dashboard { flex-direction: column; align-items: center; }
        }
    </style>
</head>
<body>

<button onclick="toggleDarkMode()">ðŸŒ™ Dark Mode</button>

<h1>NAVEED AUTOSE SHOP MANAGEMENT</h1>

<!-- âœ… MONTHLY SUMMARY DASHBOARD -->
<div class="dashboard">
    <div class="card">
        <h3>Total Profit</h3>
        <p>{{ total_profit }}</p>
    </div>
    <div class="card">
        <h3>Total Investment</h3>
        <p>{{ total_investment }}</p>
    </div>
    <div class="card">
        <h3>Total Expenses</h3>
        <p>{{ total_expenses }}</p>
    </div>
    <div class="card">
        <h3>Net Balance</h3>
        <p>{{ net_balance }}</p>
    </div>
</div>

<!-- ADD PRODUCT -->
<div class="section">
    <h2>Add Product</h2>
    <form action="/add_product" method="post">
        Name: <input type="text" name="name" required>
        Company: <input type="text" name="company" required>
        Cost Price: <input type="number" step="0.01" name="cost_price" required>
        Sell Price: <input type="number" step="0.01" name="sell_price" required>
        Quantity: <input type="number" name="quantity" required>
        <button type="submit">Add Product</button>
    </form>
</div>

<!-- PRODUCT MASTER LIST -->
<div class="section">
    <h2>Product Master List</h2>
    <table>
        <tr>
            <th>ID</th><th>Name</th><th>Company</th><th>Cost Price</th><th>Sell Price</th><th>Quantity</th>
        </tr>
        {% for product in products %}
        <tr>
            <td>{{ product.id }}</td>
            <td>{{ product.name }}</td>
            <td>{{ product.company }}</td>
            <td>{{ product.cost_price }}</td>
            <td>{{ product.sell_price }}</td>
            <td>{{ product.quantity }}</td>
        </tr>
        {% else %}
        <tr><td colspan="6">No products found</td></tr>
        {% endfor %}
    </table>
</div>

<!-- DAILY SALES ENTRY -->
<div class="section">
    <h2>Daily Sales Entry</h2>
    <form action="/add_sale" method="post">
        Product:
        <select name="product_id" required>
            {% for product in products %}
            <option value="{{ product.id }}">{{ product.name }} ({{ product.company }})</option>
            {% endfor %}
        </select>
        Quantity Sold: <input type="number" name="quantity_sold" required>
        <button type="submit">Record Sale</button>
    </form>
</div>

<!-- DAILY SALES REPORT -->
<div class="section">
    <h2>Daily Sales Report</h2>
    <table>
        <tr>
            <th>Date</th><th>Product</th><th>Company</th><th>Quantity Sold</th><th>Profit</th>
        </tr>
        {% for sale in sales %}
        <tr>
            <td>{{ sale.date }}</td>
            <td>{{ sale.product_name }}</td>
            <td>{{ sale.company }}</td>
            <td>{{ sale.quantity_sold }}</td>
            <td>{{ sale.profit }}</td>
        </tr>
        {% else %}
        <tr><td colspan="5">No sales recorded yet</td></tr>
        {% endfor %}
    </table>
</div>

<!-- INVESTMENT TRACKER -->
<div class="section">
    <h2>Investment Record</h2>
    <form action="/add_investment" method="post">
        Product:
        <select name="product_id" required>
            {% for product in products %}
            <option value="{{ product.id }}">{{ product.name }} ({{ product.company }})</option>
            {% endfor %}
        </select>
        Amount Invested: <input type="number" step="0.01" name="amount" required>
        Shop Name: <input type="text" name="shop_name" required>
        <button type="submit">Add Investment</button>
    </form>

    <h3>All Investments</h3>
    <table>
        <tr><th>Product</th><th>Company</th><th>Amount</th><th>Shop Name</th></tr>
        {% for inv in investments %}
        <tr>
            <td>{{ inv.product_name }}</td>
            <td>{{ inv.company }}</td>
            <td>{{ inv.amount }}</td>
            <td>{{ inv.shop_name }}</td>
        </tr>
        {% else %}
        <tr><td colspan="4">No investments found</td></tr>
        {% endfor %}
    </table>
</div>

<!-- EXPENSE TRACKER -->
<div class="section">
    <h2>Expense Tracker</h2>
    <form action="/add_expense" method="post">
        Description: <input type="text" name="desc" required>
        Amount: <input type="number" step="0.01" name="amount" required>
        Date: <input type="date" name="date" required>
        <button type="submit">Add Expense</button>
    </form>

    <h3>All Expenses</h3>
    <table>
        <tr><th>Date</th><th>Description</th><th>Amount</th></tr>
        {% for ex in expenses %}
        <tr>
            <td>{{ ex.date }}</td>
            <td>{{ ex.desc }}</td>
            <td>{{ ex.amount }}</td>
        </tr>
        {% else %}
        <tr><td colspan="3">No expenses found</td></tr>
        {% endfor %}
    </table>
</div>

<!-- REPORTS & CHARTS -->
<div class="section">
    <h2>Reports & Charts</h2>
    <canvas id="profitChart" width="400" height="200"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
}

// âœ… Safe JSON conversion
const rawData = {{ chart_data | tojson | safe }};
if (Array.isArray(rawData) && rawData.length > 0) {
    const ctx = document.getElementById('profitChart').getContext('2d');
    const labels = rawData.map(item => item.date);
    const profits = rawData.map(item => item.profit);

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Daily Profit (Last 7 Days)',
                data: profits,
                borderColor: 'blue',
                backgroundColor: 'rgba(0,0,255,0.1)',
                tension: 0.2,
                fill: true
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: true } },
            scales: { y: { beginAtZero: true } }
        }
    });
}
</script>

</body>
</html